<div class="imagegallery-container">
    <label>{{ 'imagegallery.choose' | i18n }}:</label>
    <div class="imagegallery-select">
        <select (change)="onImageGalleryChange($event.target)">
            <option *ngIf="imageGalleries.length === 0">
                {{ 'imagegallery.no-imagegalleries-found' | i18n }}
            </option>
            <option value="-1">{{ 'common.choose-x' | i18n : { x: 'imagegallery' | i18n | lowercase } }}</option>
            <option *ngFor="let gallery of imageGalleries" value="{{gallery.id}}">
                {{gallery.name}}
            </option>
        </select>
        <button
            class="add-spacer"
            (click)="showCreateGalleryModal($event)"
            [disabled]="bShowCreateGalleryModal"
        >{{ 'imagegallery.create-{x}' | i18n : { x: 'imagegallery' | i18n | lowercase } }}</button>
    </div>
</div>
<ng-content *ngIf="imageGalleryFiles.length > 0 && !isLoading then imagegalleryfiles; else loading;"></ng-content>
<div *ngIf="!isCollectionLoading && collectionValue != -1">
    <app-file-upload
        [tableIsLoading]="isLoading"
        [imageGalleryId]="collectionValue"
        (uploading)="startedUploadingFiles($event)"
        (fileUploaded)="finishedUploading($event)"
        (percentageDone)="percentageDone($event)"
    ></app-file-upload>
</div>
<ng-template #imagegalleryfiles>
    <div class="imagegallery-files-container">
        <div class="title">{{ 'imagegallery' | i18n }}</div>
        <div class="files">
            <div class="image-container" *ngFor="let file of imageGalleryFiles">
                <img 
                    src="{{file.filename | cdnImageGalleryUrl : 1 : 8}}"
                    title="{{file.filename}}"
                    alt="{{file.filename}}"
                    style="width: 50px; height: 50px;"
                />
            </div>
        </div>
    </div>
</ng-template>

<ng-template #loading>
    <div *ngIf="collectionValue !== -1">
        <div *ngIf="isCollectionLoading">
            {{ 'common.loading' | i18n }}
        </div>
        <div *ngIf="!isCollectionLoading && imageGalleryFiles.length == 0">
            <span>{{ 'common.no-x' | i18n : { x: 'common.images' | i18n | lowercase } }}</span>
        </div>
    </div>
</ng-template>

<app-modal
    modalTitle="{{ 'common.create-x' | i18n : { x: 'imagegallery' | i18n | lowercase } }}"
    modalId="gallery-modal"
    [renderModal]="bShowCreateGalleryModal"
    [isNestedModal]="true"
    [isRootModalWithoutNestedModal]="isRootModalWithoutNestedModal"
    (submitChanged)="addImageGallery($event)"
    (closeChanged)="closeCreateGalleryModal()"
>
    <form [formGroup]="formImageGalleryAdd">
        <div class="formline">
            <label for="name">{{ 'common.name' | i18n }}</label>
            <input id="name" type="text" formControlName="name" placeholder="{{ 'validation.fill-out-x' | i18n : { x: 'common.name' | i18n | lowercase } }}" />
        </div>
        <div class="formline">
            <label for="igDescription">{{ 'common.content' | i18n }}</label>
            <ckeditor 
                id="igDescription" 
                [editor]="classicEditor" 
                formControlName="description"
                (ready)="onReady($event)"
            ></ckeditor>
        </div>
        <div class="formline">
            <label for="igImageGalleryType">{{ 'common.type' | i18n }}</label>
            <select id="igImageGalleryType" formControlName="imageGalleryTypeId">
                <option *ngIf="imageGalleryTypes.length === 0">
                    {{ 'imagegallery.no-imagegalleries-found' | i18n }}
                </option>
                <option value="-1" disabled selected>{{ 'common.choose-x' | i18n : { x: 'imagegallery' | i18n | lowercase } }}</option>
                <option *ngFor="let imageGalleryType of imageGalleryTypes" value="{{imageGalleryType.id}}">
                    {{imageGalleryType.name}}
                </option>
            </select>
            <button
                class="add-spacer"
                (click)="showCreateTypeModal($event)"
                [disabled]="bShowCreateTypeModal"
            >{{ 'imagegallery.create-{x}' | i18n : { x: 'imagetype' | i18n | lowercase } }}</button>
        </div>
        <div class="formline">
            <label for="igImageGalleryTemplate">{{ 'common.template' | i18n }}</label>
            <input id="igImageGalleryTemplate" type="text" formControlName="imageTemplateId" [disableControl]="true" />
        </div>
    </form>
</app-modal>
<app-modal
    *ngIf="bShowCreateTypeModal"
    modalTitle="{{ 'common.create-x' | i18n : { x: 'imagetype' | i18n | lowercase } }}"
    modalId="type-modal"
    [renderModal]="bShowCreateTypeModal"
    [isNestedModal]="true"
    (submitChanged)="insertImageType($event)"
    (closeChanged)="closeCreateTypeModal($event)"
>
    <app-content-wrapper>
        <form [formGroup]="formGalleryTypeAdd">
            <div class="formline">
                <label for="name">{{ 'common.name' | i18n }}</label>
                <input id="name" type="text" formControlName="name" placeholder="{{ 'validation.fill-out-x' | i18n : { x: 'common.name' | i18n | lowercase } }}" />
                <div class="warning" *ngIf="formGalleryTypeAdd.get('name')?.invalid 
                    && (
                        formGalleryTypeAdd.get('name')?.dirty 
                        || formGalleryTypeAdd.get('name')?.touched
                    )"
                >
                    {{ 'validation.fill-out-x' | i18n : { x: 'common.name' | i18n | lowercase } }}
                </div>
            </div>
        </form>
    </app-content-wrapper>
</app-modal>